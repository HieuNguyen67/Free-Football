<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title> COVID-19 Statistics</title>
    <style>
      .cssgardient{
        
  background: -webkit-linear-gradient( #1488cc, #2b32b2);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
      }
       .csstable{
         background:linear-gradient(0deg, #FFFEFF 0%, #D7FFFE 100%);
 
      }
    </style>
    <script src="./js/jquery-3.7.1.min.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script>
      $(document).ready(function () {
        $("#dateForm").submit(function (event) {
          event.preventDefault();
          var selectedDateTime = $("#dateInput").val();

          console.log(selectedDateTime);
          var settings = {
            async: true,
            crossDomain: true,
            url:
              "https://covid-19-statistics.p.rapidapi.com/reports/total?date=" +
              selectedDateTime,
            method: "GET",
            headers: {
              "X-RapidAPI-Key":
                "59cc4e63b3msh4d842910a03af33p1c1163jsn6fe5d033ef64",
              "X-RapidAPI-Host": "covid-19-statistics.p.rapidapi.com",
            },
          };
$('#loadingIndicator1').show();

          $.ajax(settings).done(function (response) {
            console.log(response);

            if (response.data.date) {
                                        $('#loadingIndicator1').hide();

              var dateParts = response.data.date.split("-");
              var formattedDate =
                dateParts[2] + "/" + dateParts[1] + "/" + dateParts[0];

              $("#date").html(
                "Ngày " +
                  "<span class='fw-bold text-primary'>" +
                  formattedDate +
                  " </span>có thông tin về dịch bệnh như sau: "
              );

              $("#lastUpdate").html(
                "Cập nhật lần cuối vào: " +
                  "<span class='fw-bold text-primary'>" +
                  response.data.last_update +
                  "</span>"
              );
              $("#confirmed").html(
                "Tổng số ca nhiễm được xác nhận: <span class='fw-bold text-danger'>" +
                  response.data.confirmed +
                  "</span>"
              );
              $("#confirmed_diff").html(
                ", Tăng thêm so với ngày trước: " +
                  "<span class='fw-bold text-danger'>" +
                  response.data.confirmed_diff +
                  "</span>" +
                  " ca "
              );
              $("#deaths").html(
                "<span>Tổng số ca tử vong: </span>" +
                  "<span class='fw-bold text-danger'> " +
                  response.data.deaths +
                  "</span>"
              );
              $("#deaths_diff").html(
                "<span>, Tăng thêm so với ngày trước: </span>" +
                  "<span class='fw-bold text-danger'>" +
                  response.data.deaths_diff +
                  "</span>"
              );
              $("#recovered").html(
                "<span>Tổng số ca đã phục hồi: </span>" +
                  "<span class='fw-bold text-danger'>" +
                  response.data.recovered +
                  "</span>"
              );
              $("#recovered_diff").html(
                "<span>, Tăng thêm so với ngày trước: </span>" +
                  "<span class='fw-bold text-danger'>" +
                  response.data.recovered_diff +
                  "</span>"
              );
              $("#active").html(
                "<span>Tổng số ca đang điều trị:  </span>" +
                  "<span class='fw-bold text-danger'>" +
                  response.data.active +
                  "</span>"
              );
              $("#active_diff").html(
                "<span>, Tăng thêm so với ngày trước:  </span>" +
                  "<span class='fw-bold text-danger'>" +
                  response.data.active_diff +
                  "</span>"
              );
              $("#fatalityRate").html(
                "<span>Tỉ lệ tử vong: </span>" +
                  "<span class='fw-bold text-danger'>" +
                  response.data.fatality_rate * 100 +
                  "%</span>"
              );

            } else {
              alert(
                "Dữ liệu chỉ được cập nhật đến 09/03/2023. Vui lòng chọn lại !"
              );
            }
          });
        });
      });
    </script>
    <script>
      $(document).ready(function () {
        const settings = {
          async: true,
          crossDomain: true,
          url: "https://covid-19-statistics.p.rapidapi.com/regions",
          method: "GET",
          headers: {
            "X-RapidAPI-Key":
              "59cc4e63b3msh4d842910a03af33p1c1163jsn6fe5d033ef64",
            "X-RapidAPI-Host": "covid-19-statistics.p.rapidapi.com",
          },
        };

        $.ajax(settings).done(function (response) {
          $.each(response.data, function (index, item) {
            var option = $("<option>").val(item.iso).text(item.name);
            $("#isoSelect").append(option);
          });

          $("#isoSelect").change(function () {
            var selectedIso = $("#isoSelect").val();
            var regionSettings = {
              async: true,
              crossDomain: true,
              url:
                "https://covid-19-statistics.p.rapidapi.com/reports?iso=" +
                selectedIso,
              method: "GET",
              headers: {
                "X-RapidAPI-Key":
                  "59cc4e63b3msh4d842910a03af33p1c1163jsn6fe5d033ef64",
                "X-RapidAPI-Host": "covid-19-statistics.p.rapidapi.com",
              },
            };

            $.ajax(regionSettings).done(function (regionResponse) {
              $("#regionSelect").empty();
              $("#regionSelect").append(
                "<option selected>Chọn_Khu_Vực</option>"
              );

              $.each(regionResponse.data, function (index, region) {
                var option = $("<option>")
                  .val(region.region.province)
                  .text(region.region.province);

                $("#regionSelect").append(option);
              });

              $("#regionSelect").change(function () {
                var selectISO = $("#isoSelect").val();
                var selectedProvice = $("#regionSelect").val();
                var citySettings = {
                  async: true,
                  crossDomain: true,
                  url:
                    "https://covid-19-statistics.p.rapidapi.com/reports?region_province=" +
                    selectedProvice +
                    "&iso=" +
                    selectISO,
                  method: "GET",
                  headers: {
                    "X-RapidAPI-Key":
                      "59cc4e63b3msh4d842910a03af33p1c1163jsn6fe5d033ef64",
                    "X-RapidAPI-Host": "covid-19-statistics.p.rapidapi.com",
                  },
                };
                $.ajax(citySettings).done(function (cityResponse) {
                  $("#citySelect").empty();
                  $("#citySelect").append(
                    "<option selected>Chọn_Thành_Phố</option>"
                  );
                  $.each(cityResponse.data, function (index, city) {
                    $.each(city.region.cities, function (index, cities) {
                      console.log(cities);
                      var option = $("<option>")
                        .val(cities.name)
                        .text(cities.name);
                      $("#citySelect").append(option);
                    });
                  });
                });
              });
            });
          });
        });
      });
    </script>
    <script>
      $(document).ready(function () {
        $("#dateForm1").submit(function (event) {
          event.preventDefault();
          var selectedDateTime1 = $("#dateInput1").val();

          console.log(selectedDateTime1);
          var selectISO = $("#isoSelect").val();
          var selectedProvince = $("#regionSelect").val();
          var selectedCity = $("#citySelect").val();
          if (selectedProvince === "Chọn_Khu_Vực") {
            var url =
              "https://covid-19-statistics.p.rapidapi.com/reports?iso=" +
              selectISO +
              "&date=" +
              selectedDateTime1;
          } else if (selectedCity === "Chọn_Thành_Phố") {
            var url =
              "https://covid-19-statistics.p.rapidapi.com/reports?iso=" +
              selectISO +
              "&region_province=" +
              selectedProvince +
              "&date=" +
              selectedDateTime1;
          } else {
            var url =
              "https://covid-19-statistics.p.rapidapi.com/reports?region_province=" +
              selectedProvince +
              "&iso=" +
              selectISO +
              "&city_name=" +
              selectedCity +
              "&date=" +
              selectedDateTime1;
          }

          const form = {
            async: true,
            crossDomain: true,
            url: url,
            method: "GET",
            headers: {
              "X-RapidAPI-Key":
                "59cc4e63b3msh4d842910a03af33p1c1163jsn6fe5d033ef64",
              "X-RapidAPI-Host": "covid-19-statistics.p.rapidapi.com",
            },
          };
          console.log(url);
$('#loadingIndicator').show();


          $.ajax(form).done(function (response) {
            console.log(response);
            if (response.data.length !== 0) {
              if (selectedProvince === "Chọn_Khu_Vực") {
                var dataContainer = $("#dataContainer");
                dataContainer.empty();
                var html =
                  "<table class='table table-hover table-bordered table-striped rounded my-5' style='width:100%;'><tr><thead class='table-dark'><th class='fs-4'>Khu Vực</th><th class='fs-4'>Thông tin</th></thead></tr>";
                response.data.forEach(function (report) {
                  html +=
                    "<tr><td class='fw-bold fs-4 csstable'>" +
                    report.region.province +
                    "</td>";
                  html +=
                    "<td class='csstable'>Ngày <span class='fw-bold text-primary '>" +
                    report.date +
                    "</span> có thông tin về dịch bệnh như sau: ";
                  html +=
                    "<br>Tổng số ca nhiễm được xác nhận: <span class='fw-bold text-danger'>" +
                    report.confirmed +
                    "</span>";
                  html +=
                    ", Tăng thêm so với ngày trước: <span class='fw-bold text-danger'>" +
                    report.confirmed_diff +
                    "</span>";
                  html +=
                    "<br>Tổng số ca tử vong: <span class='fw-bold text-danger'>" +
                    report.deaths +
                    "</span>";
                  html +=
                    ", Tăng thêm so với ngày trước:<span class='fw-bold text-danger'> " +
                    report.deaths_diff +
                    "</span>";
                  html +=
                    "<br>Tổng số ca đã phục hồi:  <span class='fw-bold text-danger'>" +
                    report.recovered +
                    "</span>";
                  html +=
                    ", Tăng thêm so với ngày trước:  <span class='fw-bold text-danger'>" +
                    report.recovered_diff +
                    "</span>";
                  html +=
                    "<br>Cập nhật lần cuối vào:  <span class='fw-bold text-danger'>" +
                    report.last_update +
                    "</span>";
                  html +=
                    "<br>Tổng số ca đang điều trị: <span class='fw-bold text-danger'>" +
                    report.active +
                    "</span>";
                  html +=
                    ", Tăng thêm so với ngày trước: <span class='fw-bold text-danger'>" +
                    report.active_diff +
                    "</span>";
                  html +=
                    "<br>Tỉ lệ tử vong: <span class='fw-bold text-danger'>" +
                    report.fatality_rate * 100 +
                    "%</span></td></tr>";
                });
                html += "</table>";
                dataContainer.append(html);
            $('#loadingIndicator').hide();

              } else if (selectedCity === "Chọn_Thành_Phố") {
                var dataContainer = $("#dataContainer");
                dataContainer.empty();
                var html1 =
                  "<table class='table table-hover  table-bordered table-striped my-5' style='width:100%;'><thead class='table-dark'><tr><th class='fs-4'>Khu Vực</th><th class='fs-4'>Thông tin</th></thead></tr>";
                response.data.forEach(function (report1) {
                  html1 +=
                    "<tr><td class='fw-bold fs-4 csstable'>" +
                    report1.region.province +
                    "</td>";
                  html1 +=
                    "<td class='csstable'>Ngày <span class='fw-bold text-primary'>" +
                    report1.date +
                    "</span> có thông tin về dịch bệnh như sau: ";
                  html1 +=
                    "<br>Tổng số ca nhiễm được xác nhận: <span class='fw-bold text-danger'>" +
                    report1.confirmed +
                    "</span>";
                  html1 +=
                    ", Tăng thêm so với ngày trước: <span class='fw-bold text-danger'>" +
                    report1.confirmed_diff +
                    "</span>";
                  html1 +=
                    "<br>Tổng số ca tử vong: <span class='fw-bold text-danger'>" +
                    report1.deaths +
                    "</span>";
                  html1 +=
                    ", Tăng thêm so với ngày trước:<span class='fw-bold text-danger'> " +
                    report1.deaths_diff +
                    "</span>";
                  html1 +=
                    "<br>Tổng số ca đã phục hồi:  <span class='fw-bold text-danger'>" +
                    report1.recovered +
                    "</span>";

                  html1 +=
                    ", Tăng thêm so với ngày trước:  <span class='fw-bold text-danger'>" +
                    report1.recovered_diff +
                    "</span>";
                  html1 +=
                    "<br>Cập nhật lần cuối vào:  <span class='fw-bold text-primary'>" +
                    report1.last_update +
                    "</span>";
                  html1 +=
                    "<br>Tổng số ca đang điều trị: <span class='fw-bold text-danger'>" +
                    report1.active +
                    "</span>";
                  html1 +=
                    ", Tăng thêm so với ngày trước: <span class='fw-bold text-danger'>" +
                    report1.active_diff +
                    "</span>";
                  html1 +=
                    "<br>Tỉ lệ tử vong: <span class='fw-bold text-danger'>" +
                    report1.fatality_rate * 100 +
                    "%</span></td></tr>";
                });
                html1 += "</table>";
                dataContainer.append(html1);
                            $('#loadingIndicator').hide();

              } else {
                var dataContainer = $("#dataContainer");
                dataContainer.empty();
                var html2 =
                  "<table class='table table-hover  table-border table-striped rounded my-5' style='width:100%;'><thead class='table-dark'><tr><th class='fs-4'>Thành phố</th><th class='fs-4'>Thông tin</th></thead></tr>";
                response.data.forEach(function (report2) {
                  report2.region.cities.forEach(function (report3) {
                    html2 +=
                      "<tr><td class='fw-bold fs-4 csstable'>" + report3.name + "</td>";
                    html2 +=
                      "<td class='csstable'>Ngày <span class='fw-bold  text-primary'>" +
                      report3.date +
                      "</span> có thông tin về dịch bệnh như sau: ";
                    html2 +=
                      "<br>Cập nhật lần cuối vào: <span class='fw-bold  text-primary'>" +
                      report3.last_update +
                      "</span>";
                    html2 +=
                      "<br>Tổng số ca nhiễm được xác nhận: <span class='fw-bold  text-danger'>" +
                      report3.confirmed +
                      "</span>";
                    html2 +=
                      ", Tăng thêm so với ngày trước:   <span class='fw-bold  text-danger'>" +
                      report3.confirmed_diff +
                      "</span>";
                    html2 +=
                      "<br>Tổng số ca tử vong: <span class='fw-bold  text-danger'>" +
                      report3.deaths +
                      "</span>";
                    html2 +=
                      ", Tăng thêm so với ngày trước:<span class='fw-bold  text-danger'> " +
                      report3.deaths_diff +
                      "</span>";

                    html2 += "</span></td></tr>";
                  });
                });
                html2 += "</table>";
                dataContainer.append(html2);
                            $('#loadingIndicator').hide();

              }
            } else {
              alert(
                "Dữ liệu chỉ được cập nhật đến 09/03/2023. Vui lòng chọn lại !"
              );
            }
          });
        });
      });
    </script>
  </head>
  <body>
    <nav class="navbar navbar-dark bg-dark" style="background: linear-gradient(to right, #4facfe 0%, #00f2fe 100%);">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">
          <img
            src="./public/covid-19.png"
            alt="Logo"
            width="60"
            height="60"
            class="d-inline-block align-text-top rounded shadow"
          />
          <span class="fw-bold ms-2 fs-4">COVID-19 Statistics</span>
        </a>
      </div>
    </nav>
    <nav>
      <div class="nav nav-tabs nav-pills nav-fill" id="nav-tab" role="tablist" style="background: linear-gradient(to bottom, rgba(255,255,255,0.15) 0%, rgba(0,0,0,0.15) 100%), radial-gradient(at top center, rgba(255,255,255,0.40) 0%, rgba(0,0,0,0.40) 120%) #989898">
        <button
          class="nav-link active  text-light"
          id="nav-home-tab"
          data-bs-toggle="tab"
          data-bs-target="#nav-home"
          type="button"
          role="tab"
          aria-controls="nav-home"
          aria-selected="true"
          
        >
          Tra Cứu Tình Hình COVID-19
        </button>
        <button
          class="nav-link  text-light"
          id="nav-profile-tab"
          data-bs-toggle="tab"
          data-bs-target="#nav-profile"
          type="button"
          role="tab"
          aria-controls="nav-profile"
          aria-selected="false"
        >
          Tra Cứu Tình Hình COVID-19 Theo Khu Vực
        </button>
      </div>
    </nav>
    <div class="tab-content" id="nav-tabContent">
      <div
        class="tab-pane fade show active"
        id="nav-home"
        role="tabpanel"
        aria-labelledby="nav-home-tab"
        tabindex="0"
      >
        <div class="container">
          <h1
            class="text-center my-5 fw-bold cssgardient"
            style="font-family: 'Times New Roman', Times, serif"
          >
            Tra Cứu Tình Hình COVID-19 Trên Thế Giới
          </h1>
          <form id="dateForm" class="mt-3">
            <label for="dateInput" class="form-label">Chọn ngày:</label>
            <input
              type="date"
              id="dateInput"
              name="dateInput"
              class="form-control"
            />
            <button
              type="submit"
              class="btn btn-dark mt-3 px-5 py-3 col-4 fs-5"
              style="
                background: linear-gradient(19deg, #21d4fd 0%, #b721ff 100%);
                border: 0px;
              "
            >
              Tra cứu
            </button>
            <div id="loadingIndicator1" style="display: none;">
    <h5 class="mt-4">Loading...</h5>
</div>

          </form>
             <table
      class="table table-hover table-bordered  table-striped mb-5 my-4"
      style="width: 100%"
    >
      <thead  class="table-dark">
        <tr>
         
          <th class="text-center fs-5">Thông Tin</th>
         
         
        </tr>
      </thead>
      <tbody >
         <tr>
         
          <td class="csstable">
         
        
        <div id="covidInfo" class="mt-3">
            <h id="date" class="fs-5"></h>
            <p id="lastUpdate" class="fs-5 mt-1"></p>
            <p class="fs-5">
              <span id="confirmed"></span><span id="confirmed_diff"></span>
            </p>
            <p class="fs-5">
              <span id="deaths"></span><span id="deaths_diff"></span>
            </p>
            <p class="fs-5">
              <span id="recovered"></span><span id="recovered_diff"></span>
            </p>
            <p class="fs-5">
              <span id="active"></span><span id="active_diff"></span>
            </p>
            <p id="fatalityRate" class="fs-5"></p>
          </div>
          </td>
           
        </tr>
      </tbody>
    </table>

          
        </div>
      </div>

      <div
        class="tab-pane fade"
        id="nav-profile"
        role="tabpanel"
        aria-labelledby="nav-profile-tab"
        tabindex="0"
      >
        <div class="container">
          <h1
            class="text-center my-5 fw-bold cssgardient"
            style="font-family: 'Times New Roman', Times, serif"
          >
            Tra Cứu Tình Hình COVID-19 Theo Khu Vực
          </h1>
          <form id="dateForm1" class="mt-3">
            <label for="dateInput1" class="form-label">Chọn ngày:</label>
            <input
              type="date"
              id="dateInput1"
              name="dateInput1"
              class="form-control"
            />
            <div class="row mt-3">
              <div class="col">
                <label class="form-label">Chọn quốc gia:</label>
                <select
                  id="isoSelect"
                  class="form-select"
                  aria-label="Default select example"
                >
                  <option selected>Chọn quốc gia</option>
                </select>
              </div>
              <div class="col">
                <label class="form-label">Chọn khu vực:</label>
                <select
                  id="regionSelect"
                  class="form-select"
                  aria-label="Default select example"
                ></select>
              </div>
              <div class="col">
                <label class="form-label">Chọn thành phố:</label>
                <select
                  id="citySelect"
                  class="form-select"
                  aria-label="Default select example"
                ></select
                ><br />
              </div>
            </div>

            <button
              type="submit"
              class="btn btn-dark mt-3 px-5 py-3 col-4 fs-5"
              style="
                background: linear-gradient(19deg, #21d4fd 0%, #b721ff 100%);
                border: 0px;
              "
            >
              Tìm kiếm
            </button>
          </form>
          <div id="loadingIndicator" style="display: none;">
    <h5 class="mt-4">Loading...</h5>
</div>

          <div id="dataContainer" class="mt-3"></div>
        </div>
      </div>
    </div>
  </body>
</html>
