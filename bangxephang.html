<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Football Match Details</title>
    <link rel="stylesheet" href="../style.css" />
    <style>
      .csstable1 {
        background: linear-gradient(0deg, #fffefe 0%, rgb(238, 255, 192) 100%);
      }
    </style>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />

    <script src="../js/jquery-3.7.1.min.js"></script>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <div class="boxweb">
      <div class="spinner-backdrop loadingIndicator1" id="spinnerBackdrop">
        <div class="position-absolute top-50 start-50 translate-middle">
          <div class="spinner-border text-light" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
        </div>
      </div>
      <nav class="navbar navbar-expand-lg" style="background: #ffff00">
        <div class="container-fluid">
          <a
            class="navbar-brand fs-3 fw-bold ms-3 d-flex flex-row"
            href="./index.html"
            ><img
              src="../public/eFootball-konami.jpg"
              alt="Logo"
              width="80"
              height="60"
              class="d-inline-block align-text-top rounded shadow"
            /><span class="ms-3 mt-2">Free Football </span>
          </a>
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarNav"
            aria-controls="navbarNav"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              <li class="nav-item">
                <a class="nav-link" aria-current="page" href="./index.html"
                  >Highlights-Livestream</a
                >
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./lichthidau.html">Lịch thi đấu</a>
              </li>
              <li class="nav-item">
                <a class="nav-link active" href="./bangxephang.html"
                  >Bảng xếp hạng</a
                >
              </li>
              <li class="nav-item">
                <a class="nav-link" href="./news.html">Tin tức</a>
              </li>
            </ul>

            <div class="d-flex">
              <a href="./login.html"
                ><button class="btn btn-dark" id="login-item">
                  Đăng nhập
                </button></a
              >
              <a href="./signup.html" class="ms-2"
                ><button class="btn btn-primary" id="signup-item">
                  Đăng ký
                </button></a
              >
              <div>
                <a class="nav-link"
                  ><a
                    href="./news-by-user.html"
                    class="text-decoration-none text-dark"
                    ><span id="welcome-msg" class="me-3" style="display: none">
                      Hello, <span id="username-display"></span></span></a
                  ><button
                    class="btn btn-danger"
                    id="logout-btn"
                    style="display: none"
                  >
                    Đăng xuất
                  </button></a
                >
              </div>
            </div>
          </div>
        </div>
      </nav>
      <div class="imgbackground3"></div>
      <div class="container">
        <p class="text-center my-5 fw-bold yellow sizetitle fontEfootball">
          BXH BÓNG ĐÁ
        </p>

        <div class="container">
          <form id="dateForm1" class="mt-lg-5">
            <div class="col pt-lg-5">
              <label class="form-label fs-4 yellow fontEfootball"
                >Chọn Giải Đấu:
              </label>
              <select
                id="isoSelect"
                class="form-select form-select-lg"
                aria-label="Default select example"
              ></select>
            </div>

            <button
              type="submit"
              class="btn btn-dark mt-3 px-5 py-lg-3 col-lg-3 col-12 fs-5"
              style="
                background: linear-gradient(147deg, #ffe53b 0%, #ff2525 74%);
                border: 0px;
              "
            >
              Xem BXH
            </button>
          </form>
          <div id="loadingIndicator1" style="display: none">
            <h4 class="mt-4 text-light">Loading...</h4>
          </div>
          <div id="titlegiai"></div>
          <div class="pb-5">
            <div class="table-responsive">
              <table
                style="width: 100%"
                class="table table-hover table-bordered table-striped mt-3"
              >
                <thead class="table-dark">
                  <tr class="text-center">
                    <th colspan="2">CLB</th>
                    <th colspan="4">Sân Nhà</th>
                    <th colspan="4">Sân Khách</th>
                    <th colspan="8">Tổng Điểm</th>
                  </tr>
                  <tr class="text-center">
                    <th colspan="2"></th>

                    <th>P</th>
                    <th>W</th>
                    <th>D</th>
                    <th>L</th>
                    <th>P</th>
                    <th>W</th>
                    <th>D</th>
                    <th>L</th>
                    <th>P</th>
                    <th>W</th>
                    <th>D</th>
                    <th>L</th>
                    <th>F</th>
                    <th>A</th>
                    <th>+/-</th>
                    <th>Pts</th>
                  </tr>
                </thead>
                <tbody id="bangxephang"></tbody>
              </table>
            </div>
          </div>
          <div class="pb-5" id="details"></div>
        </div>

        <script>
          $(document).ready(function () {
            if (localStorage.getItem("loggedIn") === "true") {
              $("#login-item").hide();
              $("#signup-item").hide();

              $("#logout-btn").show();
              $("#welcome-msg").show();
              $("#username-display").text(localStorage.getItem("username"));
            }
            $("#logout-btn").click(function () {
              localStorage.removeItem("loggedIn");
              localStorage.removeItem("username");
              localStorage.removeItem("user_id");

              $("#login-item").show();
              $("#signup-item").show();
              $("#logout-btn").hide();
              $("#welcome-msg").hide();
            });
            const settings = {
              async: true,
              crossDomain: true,
              url: "https://football-web-pages1.p.rapidapi.com/competitions.json",
              method: "GET",
              headers: {
                "X-RapidAPI-Key":
                  "54257c898cmshdeef5687f961bf7p1e7e75jsn1052eeb0c879",
                "X-RapidAPI-Host": "football-web-pages1.p.rapidapi.com",
              },
            };

            $.ajax(settings).done(function (response) {
              $.each(response.competitions, function (index, item) {
                const fullname = item.full - name;
                var option = $("<option>").val(item.id).text(item["full-name"]);
                $("#isoSelect").append(option);
              });
            });
          });
        </script>
        <script>
          $(document).ready(function () {
            $("#dateForm1").submit(function (event) {
              event.preventDefault();
              var selectLeague = $("#isoSelect").val();
              const settings = {
                async: true,
                crossDomain: true,
                url:
                  "https://football-web-pages1.p.rapidapi.com/league-table.json?comp=" +
                  selectLeague,
                method: "GET",
                headers: {
                  "X-RapidAPI-Key":
                    "59cc4e63b3msh4d842910a03af33p1c1163jsn6fe5d033ef64",
                  "X-RapidAPI-Host": "football-web-pages1.p.rapidapi.com",
                },
              };
              $(".loadingIndicator1").show();

              $.ajax(settings)
                .done(function (response) {
                  $(".loadingIndicator1").hide();
                  var dataContainer = $("#bangxephang");
                  dataContainer.empty();
                  var dataContainer1 = $("#details");
                  dataContainer1.empty();
                  var dataContainer2 = $("#titlegiai");
                  dataContainer2.empty();
                  var title = `<p class='text-center yellow fontEfootball sizetitle mt-lg-0 mt-5' >${response["league-table"].competition.name}</p>`;
                  $("#titlegiai").append(title);

                  var detail = ` <div class="row d-flex ">
              <div class=" yellow fontEfootball fs-4 col-6">P: Số trận đã chơi</div>
              <div class=" yellow fontEfootball fs-4 col-6">W: Số trận thắng</div>
              <div class=" yellow fontEfootball fs-4 col-6">D: Số trận hòa</div>
              <div class=" yellow fontEfootball fs-4 col-6">L: Số trận thua</div>
              <div class=" yellow fontEfootball fs-4 col-6">F: Số bàn thắng ghi được</div>
              <div class=" yellow fontEfootball fs-4 col-6">A: Số bàn thua</div>
              <div class=" yellow fontEfootball fs-4 col-6">+/-: Hiệu số bàn thắng</div>
              <div class=" yellow fontEfootball  fs-4 col-6">Pts: Tổng điểm</div>
            </div>`;
                  $("#details").append(detail);
                  if (
                    response &&
                    response["league-table"] &&
                    response["league-table"].teams &&
                    response["league-table"].teams.length > 0
                  ) {
                    response["league-table"].teams.forEach(function (item) {
                      var newRow = `<tr class='sizetable '>
                        <td class='fw-bold csstable'>${item.position}</td>
                          <td class='fw-bold csstable'>${item.name}</td>
                          <td class='fw-bold csstable '><span class='blue'>${item["home-matches"].played}</span></td>
                          <td class='fw-bold csstable'><span class='blue'>${item["home-matches"].won}</span></td>
                          <td class='fw-bold csstable'><span class='blue'>${item["home-matches"].drawn}</span></td>
                          <td class='fw-bold csstable'><span class='blue'>${item["home-matches"].lost}</span></td>
                          <td class="fw-bold csstable"><span class='blue'>${item["away-matches"].played}</span></td>
                          <td class="fw-bold csstable"><span class='blue'>${item["away-matches"].won}</span></td>
                          <td class="fw-bold csstable"><span class='blue'>${item["away-matches"].drawn}</span></td>
                          <td class="fw-bold csstable"><span class='blue'>${item["away-matches"].lost}</span></td>
                          <td class="fw-bold csstable"><span class='blue'>${item["all-matches"].played}</span></td>
                          <td class="fw-bold csstable"><span class='blue'>${item["all-matches"].won}</span></td>
                          <td class="fw-bold csstable"><span class='blue'>${item["all-matches"].drawn}</span></td>
                          <td class="fw-bold csstable"><span class='blue'>${item["all-matches"].lost}</span></td>
                          <td class="fw-bold csstable"><span class='blue'>${item["all-matches"].for}</span></td>
                          <td class="fw-bold csstable"><span class='blue'>${item["all-matches"].against}</span></td>
                          <td class="fw-bold csstable"><span class='blue'>${item["all-matches"]["goal-difference"]}</span></td>
                          <td class="fw-bold csstable  text-danger">${item["total-points"]}</td>
                          </tr>`;

                      $("#bangxephang").append(newRow);
                    });
                  } else {
                    alert(
                      "Hiện chúng tôi chưa có dữ liệu cho giải đấu này, Vui lòng chọn giải khác !"
                    );
                  }
                })
                .fail(function (jqXHR, textStatus, errorThrown) {
                  alert(
                    "Hiện chúng tôi chưa có dữ liệu cho giải đấu này, Vui lòng chọn giải khác !"
                  );
                });
            });
          });
        </script>
      </div>
    </div>
  </body>
</html>
